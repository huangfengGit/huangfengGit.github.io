window.__require=function e(t,o,n){function r(i,s){if(!o[i]){if(!t[i]){var c=i.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+i+"'")}i=c}var p=o[i]={exports:{}};t[i][0].call(p.exports,function(e){return r(t[i][1][e]||e)},p,p.exports,e,t,o,n)}return o[i].exports}for(var a="function"==typeof __require&&__require,i=0;i<n.length;i++)r(n[i]);return r}({AppLoad:[function(e,t,o){"use strict";cc._RF.push(t,"4dbbd8G3dlCqZSyqoNrGpAe","AppLoad");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var r,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(i=(a<3?r(i):a>3?r(t,o,i):r(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i},i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,a){function i(e){try{c(n.next(e))}catch(t){a(t)}}function s(e){try{c(n.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,s)}c((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var o,n,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return c([e,t])}}function c(a){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(s){a=[6,s],n=0}finally{o=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var c=e("../../Boot/scirpt/BootFrameNative"),l=e("../../Boot/scirpt/CommonLoadingTip"),p=e("../../Boot/scirpt/ModuleMgr"),u=e("../../Common/script/base/AudioManager"),v=e("../../Common/script/base/BaseFrameNative"),g=e("../../Common/script/base/LocalStorage"),d=e("../../Common/script/base/MgrNative"),f=e("../../Common/script/base/ReportManager"),m=e("../../Boot/scirpt/AppConst"),h=e("../../Common/script/modules/@mogafa/utils/lib/HttpApi"),b=e("../../Boot/scirpt/Branch"),y=cc._decorator,N=y.ccclass,B=y.property,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.commonLoadingTip=null,t.defaultJsonConfig=null,t.oldLabel=null,t.newLabel=null,t.percentLabel=null,t.percentNode=null,t.ProgressBar=null,t.progress=null,t.loadSubpackageName=["GameCommon"],t.testServerId=302,t.isTestServer=!1,t._isConversioned=!1,t._count=0,t._interval=null,t._jsonObj={},t}return r(t,e),t.prototype.onLoad=function(){return i(this,void 0,void 0,function(){var e;return s(this,function(){return m.AppConst.testServerId=this.testServerId,cc.debug&&this.isTestServer&&(v.BaseFrameNative.isTestPackage=!0,v.BaseFrameNative.serverlistID=this.testServerId+""),this.commonLoadingTip.showTipLoading(),this.loadFont(),e=g.LocalStorage.getInstance().getItem("enter_b"),1==b.default.webType&&1!=e&&this.checkConversion(),this.afSdkCompleteCallback(),[2]})})},t.prototype.checkConversion=function(){var e=this;this._interval=setInterval(function(){if(v.BaseFrameNative.maccode=d.MgrNative.getInstance().getDeviceId(),e._count++,10==e._count&&1==b.default.webType&&(d.MgrNative.getInstance().report("conversion_timeout"),cc.assetManager.loadBundle("BundleA",function(){cc.director.loadScene("BundleA")}),clearInterval(e._interval)),e._isConversionValid(c.BootFrameNative.conversion))clearInterval(e._interval),console.log("track : ",c.BootFrameNative.conversion),e._jsonObj=JSON.parse(c.BootFrameNative.conversion),e.conversionResult();else{var t={af_status:"Organic"},o=d.MgrNative.getInstance().getConversion();if(e._isConversionValid(o)){var n=JSON.parse(o);t.af_status=n.af_status||"null",t.media_source=n.media_source||"null",t.campaign=n.campaign||"null",t.advertising_id=n.advertising_id||"null",c.BootFrameNative.cacheNative.conversion=JSON.stringify(t),c.BootFrameNative.conversion=c.BootFrameNative.cacheNative.conversion,clearInterval(e._interval),e._jsonObj=n,e.conversionResult()}}},1e3)},t.prototype._isConversionValid=function(e){if("string"!=typeof e)return!1;try{var t=JSON.parse(e);return"object"==typeof t&&null!==t}catch(o){return!1}},t.prototype.loadFont=function(){cc.assetManager.getBundle("Loading").load("res/font/NirmalaB",cc.Font,function(e,t){e||fgui.registerFont("NirmalaB",t)})},t.prototype.afSdkCompleteCallback=function(){return i(this,void 0,void 0,function(){var e,t,o;return s(this,function(){return(e=cc.sys.localStorage.getItem("languageType"))?m.AppConst.languageType=e:(m.AppConst.languageType="1",cc.sys.localStorage.setItem("languageType",m.AppConst.languageType)),u.AudioManager.Singleton.initMusicConfig(),(t=cc.sys.localStorage.getItem("serverid"))||(t=v.BaseFrameNative.isTestPackage?this.testServerId:v.BaseFrameNative.serverlistID),v.BaseFrameNative.serverlistID=t,cc.sys.localStorage.setItem("serverid",v.BaseFrameNative.serverlistID),v.BaseFrameNative.serverConfig=this.defaultJsonConfig.json,this.updateServerListItem(),f.default.Singleton.report("Loading_Scene"),o=g.LocalStorage.getInstance().getItem("enter_b"),0!=b.default.webType&&-1!=b.default.webType&&1!=o||(v.BaseFrameNative.packType=2,v.BaseFrameNative.apkVersion=d.MgrNative.getInstance().getAppVersion(),this.oldLabel.string="App v"+v.BaseFrameNative.apkVersion,this.newLabel.string="Res v"+v.BaseFrameNative.resVersion,this.loadSubpackage(0)),[2]})})},t.prototype.conversionResult=function(){return i(this,void 0,void 0,function(){return s(this,function(){return console.log("conversionResult",this._isConversioned),clearInterval(this._interval),"Organic"==this._jsonObj.af_status?(v.BaseFrameNative.packType=1,cc.assetManager.loadBundle("BundleA",function(){cc.director.loadScene("BundleA")})):(v.BaseFrameNative.packType=2,v.BaseFrameNative.apkVersion=d.MgrNative.getInstance().getAppVersion(),this.oldLabel.string="App v"+v.BaseFrameNative.apkVersion,this.newLabel.string="Res v"+v.BaseFrameNative.resVersion,this.loadSubpackage(0)),[2]})})},t.prototype.checkPackType=function(e){var t=d.MgrNative.getInstance().getChannelId(),o=g.LocalStorage.getInstance().getItem("acnumber")||"";v.BaseFrameNative.acnumber=o,cc.log("acnumber",o);var n=g.LocalStorage.getInstance().getItem("enter_b"),r=v.BaseFrameNative.serverlistItem.apiAdress+"/api/Game/GoogleABPlay?channelid="+t+"&organic="+d.MgrNative.getInstance().isOrganic()+"&conversion="+d.MgrNative.getInstance().getConversion()+"&package="+b.default.packageId+"&version="+d.MgrNative.getInstance().getAppVersion()+"&enter_b="+(n?1:0)+"&isEmulator="+d.MgrNative.getInstance().isEmulator("0")+"&isDev="+d.MgrNative.getInstance().isDev()+"&vn="+d.MgrNative.getInstance().isVpn()+"&isList="+d.MgrNative.getInstance().isList()+"&maccode="+d.MgrNative.getInstance().getDeviceId()+"&location="+d.MgrNative.getInstance().getLocation()+"&ip="+d.MgrNative.getInstance().getIp()+"&acnumber="+o;console.log("checkPackType url="+r),console.time("google"),h.default.http.get(r).then(function(t){console.timeEnd("google");var o=t;console.log("checkPackType HttpApi.http.get res="+JSON.stringify(t)),v.BaseFrameNative.packType=o.data.pack,console.log("pack type = "+v.BaseFrameNative.packType),v.BaseFrameNative.acnumber=o.data.acnumber,g.LocalStorage.getInstance().setItem("acnumber",v.BaseFrameNative.acnumber),1==o.data.pack?g.LocalStorage.getInstance().setItem("enter_b",0):g.LocalStorage.getInstance().setItem("enter_b",1),e&&e()}).catch(function(t){1==(g.LocalStorage.getInstance().getItem("isLoadedB")||0)&&(v.BaseFrameNative.packType=2),f.default.Singleton.report("Exception_Config",JSON.stringify(t)),e&&e()})},t.prototype.updateServerListItem=function(){v.BaseFrameNative.serverConfig.serverlist.forEach(function(e){e.idx==v.BaseFrameNative.serverlistID&&(v.BaseFrameNative.serverlistItem=e)}),v.BaseFrameNative.serverlistItem||(v.BaseFrameNative.serverlistItem=v.BaseFrameNative.serverConfig.serverlist[0])},t.prototype.redirectToLogin=function(){return i(this,void 0,void 0,function(){var e,t=this;return s(this,function(o){switch(o.label){case 0:return[4,xgameTable.getTableMgr().loadJsonData()];case 1:return o.sent(),this.percentNode.width=0,cc.tween(this.percentNode).to(1.5,{width:850}).delay(.2).call(function(){t.loadScene("GameHall","gameHall")}).start(),e=function(){var o=t.percentNode.width;t.percentLabel.string=Math.floor(o/850*100)+"%",1667==o&&t.unschedule(e)},this.schedule(e,0),[2]}})})},t.prototype.loadScene=function(e,t){var o=cc.assetManager.getBundle(e);null==o?cc.assetManager.loadBundle(e,function(o,n){o||n.loadScene(t,function(o,n){o?console.error(e+" load fail."+t):cc.director.runScene(n)})}):o.loadScene(t,function(o,n){o?console.error(e+" load fail."+t):cc.director.runScene(n)})},t.prototype.loadSubpackage=function(){return i(this,void 0,void 0,function(){var e=this;return s(this,function(){return Promise.all([p.default.load("GameCommon")]).then(function(){e.redirectToLogin()}).catch(function(){console.error("load fail")}),[2]})})},a([B(l.default)],t.prototype,"commonLoadingTip",void 0),a([B(cc.JsonAsset)],t.prototype,"defaultJsonConfig",void 0),a([B(cc.Label)],t.prototype,"oldLabel",void 0),a([B(cc.Label)],t.prototype,"newLabel",void 0),a([B(cc.Label)],t.prototype,"percentLabel",void 0),a([B(cc.Node)],t.prototype,"percentNode",void 0),a([B(cc.Node)],t.prototype,"ProgressBar",void 0),a([B(cc.Node)],t.prototype,"progress",void 0),a([B({type:cc.Integer,visible:function(){return!1}})],t.prototype,"testServerId",void 0),a([B({visible:!1})],t.prototype,"isTestServer",void 0),a([N],t)}(cc.Component);o.default=_,cc._RF.pop()},{"../../Boot/scirpt/AppConst":void 0,"../../Boot/scirpt/BootFrameNative":void 0,"../../Boot/scirpt/Branch":void 0,"../../Boot/scirpt/CommonLoadingTip":void 0,"../../Boot/scirpt/ModuleMgr":void 0,"../../Common/script/base/AudioManager":void 0,"../../Common/script/base/BaseFrameNative":void 0,"../../Common/script/base/LocalStorage":void 0,"../../Common/script/base/MgrNative":void 0,"../../Common/script/base/ReportManager":void 0,"../../Common/script/modules/@mogafa/utils/lib/HttpApi":void 0}]},{},["AppLoad"]);